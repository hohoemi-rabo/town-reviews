# 「まち口コミ帳」要件定義書

## 1. サービス概要

### 1.1 プロジェクト名

**まち口コミ帳** - 「誰に教わったか」まで残す地図

### 1.2 コンセプト

地域の口コミ文化をデジタルで可視化し、人づての情報の連鎖を地図上に残す Web サービス

### 1.3 ターゲットユーザー

- **主要**: 南信州（飯田・下伊那）地域の住民
- **副次**: 観光客、移住者、新住民

### 1.4 提供価値

- 消えていく口頭の情報をデジタルで保存
- 情報源（誰から聞いたか）の明示による信頼性向上
- 店舗側の負担なく地域情報を蓄積

---

## 2. 機能要件

### 2.1 投稿機能

#### 2.1.1 基本投稿機能

| 項目             | 仕様                                                         |
| ---------------- | ------------------------------------------------------------ |
| スポット指定     | Google マップ共有リンクを貼り付け                            |
| 情報源入力       | プリセット選択 + その他（自由記述）                          |
| プリセット選択肢 | 家族・親戚 / 友人・知人 / 近所の人 / お店の人 / SNS / その他 |
| メモ入力         | 自由記述（最大 200 文字）                                    |
| 写真投稿         | 最大 3 枚まで（1 枚 5MB 以内、JPEG/PNG）                     |
| 投稿者名         | 匿名 or ニックネーム（任意）                                 |
| 複数投稿         | 同一スポットへの複数回投稿可能                               |

#### 2.1.2 投稿時の AI 機能

- 不適切コンテンツの自動検出
- やさしいトーンへの自動変換（ON/OFF 切り替え可能）
- 自動タグ生成（#カフェ #子連れ OK など）
- 季節タグの自動付与

#### 2.1.3 投稿の編集・削除

| 機能     | 条件                                       |
| -------- | ------------------------------------------ |
| 編集     | 投稿から 24 時間以内のみ可能               |
| 削除     | 投稿から 24 時間以内のみ可能               |
| 識別方法 | Cookie + ローカルストレージ（30 日間保持） |

### 2.2 閲覧機能

#### 2.2.1 地図表示

- 南信州エリアを中心とした地図表示
- スポット種別によるピン色分け
  - 飲食: 橙色
  - 体験: 青色
  - 自然: 緑色
  - 温泉: 茶色
- ピンのクラスタリング（ズームレベルに応じて）

#### 2.2.2 口コミ表示

- カード型 UI（スマホ最適化、1 列スライド）
- 表示情報:
  - スポット名
  - 口コミ内容
  - 情報源（誰から聞いたか）
  - 投稿写真（あれば）
  - タグ
  - 季節・投稿日時
  - 投稿者名（匿名可）
  - リアクション数

#### 2.2.3 検索・フィルタ

- タグによる絞り込み
- 季節での絞り込み
- キーワード検索
- 情報源タイプでのフィルタ

### 2.3 リアクション機能

#### 2.3.1 リアクションスタンプ

| スタンプ | 意味         | 実装                         |
| -------- | ------------ | ---------------------------- |
| 😊       | ほっこり     | ローカルストレージで重複防止 |
| 👍       | 行ってみたい | 同上                         |
| 📝       | メモした     | 同上                         |

- アカウント不要で利用可能
- 1 投稿につき複数種類のリアクション可能
- リアクション数をリアルタイム表示

### 2.4 AI 要約機能

#### 2.4.1 月次レポート生成

- 「今月のまちの声」自動生成
- 人気スポットランキング
- 新規発見スポット紹介
- トレンドタグの抽出

### 2.5 管理機能

#### 2.5.1 管理者権限

- 全投稿の閲覧
- 不適切投稿の削除
- 投稿内容の編集
- 24 時間経過後も編集・削除可能

#### 2.5.2 管理画面

- 投稿一覧表示（新着順/通報順）
- 一括削除機能
- 投稿統計ダッシュボード

---

## 3. 非機能要件

### 3.1 性能要件

| 項目               | 目標値          |
| ------------------ | --------------- |
| ページ読み込み時間 | 3 秒以内        |
| 地図初期表示       | 2 秒以内        |
| 同時接続数         | 100 ユーザー    |
| レスポンスタイム   | 1 秒以内（API） |

### 3.2 セキュリティ要件

- HTTPS 必須
- SQL インジェクション対策
- XSS 対策
- CSRF 対策
- 画像アップロード時のウイルスチェック
- IP アドレスのハッシュ化保存

### 3.3 ユーザビリティ要件

- スマートフォンファースト設計
- 60 歳以上でも使いやすい UI
- 文字サイズ調整機能
- 音声読み上げ対応（将来）

### 3.4 可用性要件

- 稼働率: 99%以上
- バックアップ: 日次
- 障害復旧時間: 24 時間以内

---

## 4. データ設計

### 4.1 主要テーブル

#### places（場所情報）

| カラム名   | 型        | 説明            |
| ---------- | --------- | --------------- |
| id         | UUID      | 主キー          |
| place_id   | String    | Google Place ID |
| name       | String    | スポット名      |
| lat        | Float     | 緯度            |
| lng        | Float     | 経度            |
| category   | String    | カテゴリ        |
| created_at | Timestamp | 作成日時        |

#### recommendations（口コミ）

| カラム名          | 型        | 説明          |
| ----------------- | --------- | ------------- |
| id                | UUID      | 主キー        |
| place_id          | UUID      | 場所 ID（FK） |
| heard_from        | String    | 情報源        |
| heard_from_type   | String    | 情報源タイプ  |
| note_raw          | Text      | 元メモ        |
| note_formatted    | Text      | 整形後メモ    |
| tags              | Array     | タグ配列      |
| season            | String    | 季節          |
| author_name       | String    | 投稿者名      |
| author_ip_hash    | String    | IP ハッシュ   |
| is_anonymous      | Boolean   | 匿名フラグ    |
| images            | Array     | 画像 URL 配列 |
| created_at        | Timestamp | 投稿日時      |
| updated_at        | Timestamp | 更新日時      |
| is_editable_until | Timestamp | 編集可能期限  |

#### reactions（リアクション）

| カラム名          | 型        | 説明             |
| ----------------- | --------- | ---------------- |
| id                | UUID      | 主キー           |
| recommendation_id | UUID      | 口コミ ID（FK）  |
| reaction_type     | String    | リアクション種別 |
| user_identifier   | String    | ユーザー識別子   |
| created_at        | Timestamp | 作成日時         |

#### monthly_digests（月次要約）

| カラム名      | 型        | 説明            |
| ------------- | --------- | --------------- |
| id            | UUID      | 主キー          |
| year_month    | String    | 年月（YYYY-MM） |
| summary       | Text      | AI 生成要約     |
| popular_spots | JSON      | 人気スポット    |
| trending_tags | Array     | トレンドタグ    |
| created_at    | Timestamp | 生成日時        |

---

## 5. システム構成

### 5.1 技術スタック

| 層             | 技術             | バージョン/備考  |
| -------------- | ---------------- | ---------------- |
| フロントエンド | Next.js          | 15               |
|                | React            | 19               |
|                | Tailwind CSS     | 最新版           |
|                | TypeScript       | 5.x              |
| バックエンド   | Supabase         | -                |
| データベース   | PostgreSQL       | Supabase 提供    |
| ストレージ     | Supabase Storage | 画像保存用       |
| 認証           | -                | MVP では実装なし |
| 地図           | Google Maps API  | JavaScript API   |
| AI             | OpenAI API       | GPT-4o-mini      |
| ホスティング   | Vercel           | -                |

### 5.2 API 設計

#### エンドポイント一覧

| メソッド | パス                     | 説明                    |
| -------- | ------------------------ | ----------------------- |
| POST     | /api/parse-gmaps         | Google マップリンク解析 |
| GET      | /api/places              | 場所一覧取得            |
| POST     | /api/recommendations     | 口コミ投稿              |
| PUT      | /api/recommendations/:id | 口コミ編集              |
| DELETE   | /api/recommendations/:id | 口コミ削除              |
| GET      | /api/recommendations     | 口コミ一覧取得          |
| POST     | /api/reactions           | リアクション追加        |
| DELETE   | /api/reactions/:id       | リアクション削除        |
| POST     | /api/ai/tone             | トーン変換              |
| POST     | /api/ai/tags             | タグ生成                |
| GET      | /api/digest/monthly      | 月次要約取得            |
| POST     | /api/upload/image        | 画像アップロード        |

---

## 6. UI/UX デザイン

### 6.1 デザインコンセプト

- **テーマ**: 和紙・クラフト紙風の温かみ
- **カラー**: アースカラー（ベージュ × 深緑 × 柿色）
- **フォント**: Zen Maru Gothic（丸みのある柔らか書体）
- **アニメーション**: ふわっとした動き、スタンプ風エフェクト

### 6.2 レスポンシブ対応

| デバイス       | ブレークポイント | 表示仕様                  |
| -------------- | ---------------- | ------------------------- |
| スマートフォン | ~640px           | 1 カラム、フル幅表示      |
| タブレット     | 641px~1024px     | 2 カラム可能              |
| デスクトップ   | 1025px~          | サイドバー + メインエリア |

### 6.3 アクセシビリティ

- WCAG 2.1 レベル AA 準拠
- 十分なコントラスト比（4.5:1 以上）
- キーボード操作対応
- スクリーンリーダー対応

---

## 7. 運用要件

### 7.1 初期データ

- 飯田周辺 10 件のサンプルデータを事前登録
- CSV インポート機能で一括登録

### 7.2 利用規約・プライバシーポリシー

- サービス開始前に策定
- 投稿時の同意取得フロー実装

### 7.3 サポート体制

- 問い合わせフォーム設置
- FAQ ページ作成
- 初期は管理者 1 名で対応

---

## 8. 開発スケジュール

### 8.1 フェーズ分け

#### Phase 1: MVP 開発（2-3 週間）

- Week 1: 基本 UI 実装
  - 地図表示
  - カード型口コミ表示
  - 投稿モーダル
- Week 2: バックエンド実装
  - Supabase 連携
  - API 開発
  - 画像アップロード
- Week 3: 仕上げ
  - リアクション機能
  - 管理画面
  - テスト・デバッグ

#### Phase 2: β 版リリース（MVP 後 1 ヶ月）

- AI 機能強化
- 月次レポート生成
- パフォーマンス最適化

#### Phase 3: 正式版（β 版後 2 ヶ月）

- ユーザーアカウント機能
- 通知機能
- PWA 対応

### 8.2 成功指標（KPI）

| 指標                   | MVP    | 3 ヶ月後 | 6 ヶ月後 |
| ---------------------- | ------ | -------- | -------- |
| 月間投稿数             | 50 件  | 200 件   | 500 件   |
| 月間アクティブユーザー | 100 人 | 500 人   | 1,500 人 |
| 登録スポット数         | 50 件  | 200 件   | 500 件   |

---

## 9. リスクと対策

### 9.1 技術的リスク

| リスク           | 影響度 | 対策                                 |
| ---------------- | ------ | ------------------------------------ |
| 不適切投稿の増加 | 高     | AI 自動検出 + 管理者確認             |
| サーバー負荷     | 中     | CDN 活用、キャッシュ最適化           |
| 地図 API 制限    | 中     | 使用量モニタリング、必要時有料プラン |

### 9.2 事業リスク

| リスク           | 影響度 | 対策                         |
| ---------------- | ------ | ---------------------------- |
| 初期ユーザー獲得 | 高     | 地域 SNS・回覧板での告知     |
| 投稿の偏り       | 中     | インセンティブ設計検討       |
| 継続的な投稿     | 高     | ゲーミフィケーション要素追加 |

---

## 10. 今後の拡張構想

### 10.1 機能拡張

- 投稿者ランキング・バッジ機能
- お気に入りスポット保存
- ルート作成機能
- AR モード（将来）

### 10.2 地域展開

- 他地域へのシステム提供
- 地域ごとのカスタマイズ対応
- 自治体連携モデル

### 10.3 収益化

- 地元企業スポンサー広告
- プレミアム分析機能（店舗向け）
- 自治体向けデータ提供

---

## 改訂履歴

| 版  | 日付       | 内容     | 作成者 |
| --- | ---------- | -------- | ------ |
| 1.0 | 2025-10-25 | 初版作成 | -      |

---

## 付録

### A. 用語集

- **まち口コミ帳**: 本サービスの名称
- **情報源**: 「誰から聞いたか」の情報
- **リアクション**: いいねに相当する機能
- **月次要約**: AI 生成の月間レポート

### B. 参考資料

- Google Maps API ドキュメント
- Supabase ドキュメント
- Next.js 15 リリースノート
