# 003: 地図表示機能

## 概要
Google Maps JavaScript APIを使用した地図表示とピンのクラスタリング実装

## 優先度
🔴 最高

## 見積もり時間
8時間

## Phase
Phase 1 - Week 1

## 詳細仕様

### 地図設定
- **初期表示**: 南信州エリア（飯田市周辺）
- **初期座標**: 緯度 35.5147, 経度 137.8261
- **初期ズームレベル**: 12
- **地図スタイル**: カスタムスタイル（和紙風、アースカラー）

### ピン表示仕様
| カテゴリ | 色   | アイコン         |
|----------|------|------------------|
| 飲食     | 橙色 | restaurant       |
| 体験     | 青色 | local_activity   |
| 自然     | 緑色 | park             |
| 温泉     | 茶色 | hot_tub          |

### クラスタリング
- ズームレベルに応じて自動クラスタリング
- クラスタマーカーには含まれるスポット数を表示
- クラスタクリックでズームイン

### インタラクション
- ピンクリックで詳細情報表示
- 地図ドラッグで移動
- ピンチ/スクロールでズーム
- 現在地ボタン（GPS使用）

## 実装タスク

- [ ] Google Maps APIスクリプト読み込み設定
- [ ] 地図コンポーネント作成（`src/components/Map/Map.tsx`）
- [ ] カスタム地図スタイル定義（和紙風デザイン）
- [ ] カテゴリ別ピンアイコン作成
  - [ ] SVGアイコン準備
  - [ ] カテゴリごとの色分け実装
- [ ] マーカークラスタリングライブラリ導入
  - [ ] `@googlemaps/markerclusterer`インストール
  - [ ] クラスタリング設定
- [ ] 現在地取得機能実装
- [ ] マーカークリック時のイベントハンドラ
- [ ] レスポンシブ対応（モバイル/デスクトップ）
- [ ] 地図初期表示パフォーマンス最適化
- [ ] エラーハンドリング（API読み込み失敗時）
- [ ] ローディング状態の実装

## 関連ファイル
- `src/components/Map/Map.tsx` (作成)
- `src/components/Map/MapMarker.tsx` (作成)
- `src/components/Map/MarkerCluster.tsx` (作成)
- `src/lib/google-maps.ts` (作成)
- `src/styles/map-styles.ts` (作成)
- `public/icons/map-markers/` (作成)

## 完了条件
- [×] 地図が正常に表示される
- [×] 南信州エリアが初期表示される
- [×] カテゴリ別にピンが色分けされている
- [×] クラスタリングが動作している
- [×] ピンクリックで詳細情報が表示される
- [×] レスポンシブ対応ができている
- [×] 2秒以内に地図が表示される（パフォーマンス要件）

## 備考
- Google Maps APIの使用量を定期的にモニタリング
- カスタムマーカーはSVGで作成し、軽量化
- Next.js 15のServer Componentsを活用してパフォーマンス最適化
