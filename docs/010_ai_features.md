# 010: AI機能（トーン変換・タグ生成）

## 概要
OpenAI APIを使用した投稿時のトーン変換とタグ自動生成

## 優先度
🟢 中

## 見積もり時間
6時間

## Phase
Phase 2 - β版

## 詳細仕様

### 1. やさしいトーンへの変換
- **入力**: ユーザーの生メモ
- **出力**: やさしく読みやすい文章
- **ON/OFF**: ユーザーが選択可能
- **モデル**: GPT-4o-mini
- **最大文字数**: 200文字

#### プロンプト例
```
以下の口コミを、温かくて親しみやすいトーンに変換してください。
地域の人々が使うような柔らかい表現を心がけてください。
200文字以内にまとめてください。

元の文章: {user_input}
```

### 2. 自動タグ生成
- **入力**: 投稿内容 + スポット名
- **出力**: タグ配列（最大5個）
- **モデル**: GPT-4o-mini

#### タグカテゴリ
- スポット種類: #カフェ #レストラン #温泉 など
- 特徴: #子連れOK #ペット可 #駐車場あり など
- 雰囲気: #静か #おしゃれ #レトロ など
- 時間帯: #朝活 #ランチ #ディナー など

#### プロンプト例
```
以下のスポット情報と口コミから、適切なタグを最大5個生成してください。
タグは#から始めてください。

スポット名: {spot_name}
口コミ: {note}

タグの例: #カフェ #子連れOK #静か #ランチ #駐車場あり
```

### 3. 不適切コンテンツ検出
- **使用**: OpenAI Moderation API
- **検出項目**:
  - 暴力的表現
  - 差別的表現
  - 性的表現
  - 誹謗中傷
- **処理**: 検出時は投稿をブロック

### 4. 季節タグ自動付与
- 投稿日時から自動判定
- 3月〜5月: #春
- 6月〜8月: #夏
- 9月〜11月: #秋
- 12月〜2月: #冬

## 実装タスク

- [ ] OpenAI API設定
  - [ ] APIキー設定
  - [ ] クライアント初期化
- [ ] トーン変換API実装（`/api/ai/tone`）
  - [ ] プロンプト設計
  - [ ] GPT-4o-mini呼び出し
  - [ ] レスポンス整形
  - [ ] エラーハンドリング
- [ ] タグ生成API実装（`/api/ai/tags`）
  - [ ] プロンプト設計
  - [ ] タグパース処理
  - [ ] 重複排除
- [ ] Moderation API実装（`/api/ai/moderate`）
  - [ ] コンテンツチェック
  - [ ] 不適切判定
- [ ] 季節タグ自動付与機能
  - [ ] 日付から季節判定
  - [ ] タグ配列に追加
- [ ] UI実装
  - [ ] トーン変換ON/OFFトグル
  - [ ] 変換前/変換後プレビュー
  - [ ] 自動生成タグの表示・編集
  - [ ] ローディング表示
- [ ] キャッシング機能
  - [ ] 同一内容のリクエスト削減
  - [ ] Redis検討（将来）
- [ ] 使用量モニタリング
  - [ ] API使用量記録
  - [ ] コスト管理

## 関連ファイル
- `src/app/api/ai/tone/route.ts` (作成)
- `src/app/api/ai/tags/route.ts` (作成)
- `src/app/api/ai/moderate/route.ts` (作成)
- `src/lib/openai.ts` (作成)
- `src/lib/season-detector.ts` (作成)
- `src/components/PostModal/ToneToggle.tsx` (作成)
- `src/components/PostModal/TagEditor.tsx` (作成)

## 完了条件
- [×] トーン変換が正常に動作する
- [×] タグが適切に生成される
- [×] 不適切コンテンツが検出される
- [×] 季節タグが自動付与される
- [×] UI/UXが直感的
- [×] エラーハンドリングが適切
- [×] API使用量が最適化されている

## 備考
- OpenAI APIコストを定期的にモニタリング
- トークン数削減のためプロンプト最適化
- キャッシングでAPI呼び出し削減
- レート制限対応（リトライロジック）
