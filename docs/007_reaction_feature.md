# 007: リアクション機能

## 概要
アカウント不要で使えるスタンプ型リアクション機能

## 優先度
🟡 高

## 見積もり時間
4時間

## Phase
Phase 1 - Week 3

## 詳細仕様

### リアクション種類
| スタンプ | 意味         | テキスト     |
|----------|--------------|--------------|
| 😊       | ほっこり     | ほっこり     |
| 👍       | 行ってみたい | 行ってみたい |
| 📝       | メモした     | メモした     |

### 重複防止機能
- LocalStorageで管理
- ユーザー識別子: UUID生成（初回訪問時）
- 同一ユーザーが同じ投稿に同じリアクションを複数回押せない
- 異なるリアクションは同時に押せる

### リアルタイム更新
- Supabase Realtimeで自動更新
- 他のユーザーのリアクションをリアルタイム反映

### UI/UX
- ボタンホバーでアニメーション
- 押した瞬間に拡大アニメーション
- リアクション数のカウントアップアニメーション
- 押したリアクションは色が変わる

## 実装タスク

- [ ] ユーザー識別子生成機能
  - [ ] UUIDライブラリ導入
  - [ ] LocalStorageへの保存
  - [ ] `useUserId` hook作成
- [ ] リアクションコンポーネント作成（`ReactionButtons.tsx`）
- [ ] リアクション追加API（`/api/reactions`）
  - [ ] 重複チェック
  - [ ] データベース挿入
- [ ] リアクション削除API（`/api/reactions/[id]`）
  - [ ] 所有権確認
  - [ ] データベース削除
- [ ] リアクション数取得機能
  - [ ] 投稿ごとの集計
  - [ ] リアルタイム更新
- [ ] Supabase Realtime設定
  - [ ] `reactions`テーブルの購読
  - [ ] リアクション追加/削除時の更新
- [ ] LocalStorage管理機能
  - [ ] リアクション履歴の保存
  - [ ] 重複チェック
- [ ] アニメーション実装
  - [ ] ボタンホバーアニメーション
  - [ ] クリック時の拡大アニメーション
  - [ ] カウント更新アニメーション
- [ ] アクセシビリティ対応
  - [ ] ARIA labels
  - [ ] キーボード操作対応

## 関連ファイル
- `src/components/Reaction/ReactionButtons.tsx` (作成)
- `src/components/Reaction/ReactionButton.tsx` (作成)
- `src/app/api/reactions/route.ts` (作成)
- `src/app/api/reactions/[id]/route.ts` (作成)
- `src/hooks/useUserId.ts` (作成)
- `src/hooks/useReactions.ts` (作成)
- `src/lib/local-storage.ts` (作成)

## 完了条件
- [×] リアクションボタンが表示される
- [×] クリックでリアクションが追加される
- [×] 重複リアクションが防止される
- [×] リアクション数がリアルタイム更新される
- [×] アニメーションが正常に動作する
- [×] LocalStorageで状態が保持される
- [×] アクセシビリティ要件を満たしている

## 備考
- LocalStorageが使えない環境ではCookie fallback
- Supabase Realtimeの接続数上限に注意
- アニメーションはフレーマーモーションを使用
